<!DOCTYPE html>
<html lang="en">
 
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Hola Vue</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    </head>
        
  <body>
    <div id="app">      
        <nav class="navbar navbar-light bg-info fixed-top">
          <span class="navbar-brand mb-0 h1">Hola 0048</span>
          <ul class="navbar-nav">
            <li class="navbar-item">
              <a class="nav-link" href="#" @click="">CARRO:{{cart.length}}</a>
            </li>
          </ul>
        </nav>
        <div class="container pt-4">      
          <product :premium="premium" :cart="cart" @add-to-cart="addToCart" @remove-from-cart="removeFromCart"></product>      
        </div>
    

    <div class="modal show" tabindex="-1" :style="modalStyle" :class="{ show: displayCart }">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Modal title</h5>
            <button type="button" class="close" @click="displayCart=false" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Modal body text goes here.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal" @click="displayCart=false">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>

  </div>


      <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>  
      <script type="text/x-template" id="template-product">
        <div class="row pt-5">
            <div class="col-12 col-md-6">
                <img v-bind:src="img"   width="100%">           
            </div>
            <div class="col-12 col-md-6">
              <h1>{{ product }} </h1>
              <h2>{{ description}}</h2>
              <h4>{{stock}}</h4>
              <p v-if='stock>10'> en stock</p>
              <p v-else-if= 'stock <= 10 && stock > 0'>quedan muy pocas </p>
              <p v-else>Agotadas</p>
                <ul>
                  <li v-for='(detail, index) in details' :key="index">{{detail}}</li>
                </ul>
                <div v-for='variant in variants' :key='variant.id'>
                  <p v-on:mouseover='updateProduct(variant)'>{{variant.type}}</p>
                </div>
              <a :href="link">ver</a>   
              <p>Costo de envío: {{shipping}}</p>         
              <button class="btn btn-sm btn-info" @click='addToCart' :disabled="!inStock"> agragar  al carro</button>
              <button class="btn btn-sm btn-warning" @click='removeFromCart'>Sacar del carro</button>
            </div>
      </div>
    </script>  
  </body>    
</html>

<script>
Vue.component ("product", { //primero dos argumentos el nombre del componente y obejeto (vacio) segundo argumento
props:{
  premium: {/*el que define el props es quién lo recibe, informacion que se enviará del padre al hijo con props*/
    type: Boolean,
    required: true,    
  },
  cart: {
      type: Array,
      required: true
  }

},
  data() {
    return{
          description:'loren ipsum',
          product: 'Longaniza de Brocolli',
          selectedVariant: {},
          link:'./longaniza.html',
          details: ["500 gr", "organica", "libre de colesterol"],
          variants:[{
              id:5,
              type:'red',
              img: 'assets/roja.jpeg',
              stock:10,
              default: true
          },
          {
              id:4,
              type:'white',
              img: 'assets/blanca.png',
              stock: 0
            }
        ],
      }
  },
  methods: {//hijo
          updateProduct(variant) {
            this.selectedVariant=variant;
        },
        addToCart(){
         this.$emit("add-to-cart", this.selectedVariant)
          this.selectedVariant.stock-=1
        },
        removeFromCart(){   
            var variantInCart = this.cart.find(product => product== this.selectedVariant)        
            
            if(variantInCart){
              this.$emit("remove-from-cart", this.selectedVariant)
            this.selectedVariant.stock+=1    
             }     
        }
      },
  computed: {
        inStock(){
           return this.stock>0 ? true :false //retornar el stock >0 ? (if) es verdadero : (si no)  es falso 
        },
        img(){
          return this.selectedVariant.img
        },
        stock(){
          return this.selectedVariant.stock
        },

          shipping(){
            
            return this.premium == true ? "Gratis" : "2.000"
          }
      },

      created() {
        
        this.selectedVariant= this.variants.find(item => item.default ==true)
        
      },

  template: '#template-product'  
  })
    var app = new Vue({
        el: '#app',
        data:{
          cart:[],
          premium: true,
          showStyle: {
            display: "block",
            "padding-right": "16px",
            "padding-top": "20px"
            },
          displayCart: false
        },
        methods: {//los metodos se pueden separar con mayusculas
          addToCart(variant){
            this.cart.push(variant);
          },

          removeFromCart(variant){
            var index = this.cart.indexOf(variant)//indexOff devuelve la posicion del objeto dentro del arreglo
            if(index>-1){
              this.cart.splice(index, 1)//splice elimina el objeto con ese indice (index) y borra 1 de los objetos por posicion
            }
          }
        },
        computed:{
          modalStyle(){
            if(this.displayCart){
              return this.showStyle
            }
            else{
              return {}
            }
          }
        }
    })

    </script>